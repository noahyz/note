### 一、一个键值数据库应该包含什么

#### 1. 可以存哪些数据

#### 2. 可以对数据进行什么操作（CURD）

#### 3. 数据如何存储

内存还是外存，数据访问速度和数据持久化时间 

#### 4. 四个部分：访问框架、索引模块、操作模块、存储模块

#### 5. 采用什么访问模式

1. 使用sdk方式 
2. 使用网络传输

#### 6. 如何定位键值对的位置

采用什么数据结构存储，哈希表、B+树、字典树

#### 7. 不同操作的具体逻辑

新增、删除的操作需要分配和释放内存。如何快速分配和释放内存

#### 8. 如何实现重启后快速提供服务

### 二、redis 有哪些慢操作

redis中键和值之间采用哈希表来保存所有键值对。当往 Redis 中写入大量数据后，就可能发现操作有时候会突然变慢了。这其实是因为**哈希表的冲突问题和 rehash 可能带来的操作阻塞**。

redis解析哈希冲突采用链表构造哈希冲突链。哈希表做 rehash 操作，rehash 也就是增加现有的哈希桶数量，让逐渐增多的 entry 元素能在更多的桶之间分散保存，减少单个桶中的元素数量，从而减少单个桶中的冲突。

redis实现的 rehash 操作，全局有默认有两个哈希表，一开始，当刚插入数据时，默认使用哈希表 1，此时的哈希表 2 并没有被分配空间。随着数据逐步增多，Redis 开始执行 rehash，这个过程分为三步：

1. 给哈希表 2 分配更大的空间，例如是当前哈希表 1 大小的两倍
2. 把哈希表 1 中的数据重新映射并拷贝到哈希表 2 中（大量的数据拷贝，如果一次性把哈希表 1 中的数据都迁移完，会造成 Redis 线程阻塞，无法服务其他请求。此时，Redis 就无法快速访问数据了。）
3. 释放哈希表 1 的空间

