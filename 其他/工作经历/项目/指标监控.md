## 指标监控



### 工作经历

l 协议设计：窄表改造成宽表，业界著名监控系统prometheus、statsd等协议采用的是窄表（一张表一个指标）上报数据，通过在telegraf支持窄表转换宽表（一张表多个指标），大幅降低了数据的上报流量。例如：开源Flink自监控数据上报流量从10GB/m降至2GB/m

l Tccm-Agent设计&开发，分析了业界和公司内监控Agent实现，最终基于开源项目telegraf 进行改造，适配云监控中台的数据上报协议，使得原来采用prometheus、statsd、influx line protocol、kafka等协议上报数据的用户，可以方便的将数据转发上报到云监控中台；且为了降低维护成本，增加了一些必要的功能，例如：热更新配置、自监控、合并聚合监控数据等等

l Tccm-SDK设计&开发：分析了业界（prometheus、datadog、influxdb等）和公司内（007、monitor等）SDK的上报协议和实现；基于pb/文本两种传输协议；支持公司内部和业界所有的数据统计方式；性能上每秒上报指标量可以达到百万级别，而其他SDK都只是在十万级别；且支持多语言（go、c++、java、python、php等）



协议设计：窄表改造成宽表，业界著名监控系统prometheus、statsd等协议采用的是窄表（一张表一个指标）上报数据，通过在Tccm-SDK和Tccm-Agent支持窄表转换宽表（一张表多个指标），大幅降低了数据的上报流量。
性能：例如开源Flink自监控数据上报流量从10GB/m降至2GB/m


Tccm-Agent的设计与开发：调研分析了业界和公司内监控Agent的实现，最终采用微内核架构，面向功能进行拆分插件种类，分为输入、预处理、聚合、输出插件，以配置文件的方式实现插件注册机制进行插件管理，不同种类的插件之间通过线程安全队列进行连接通信，插件完全解藕，可扩展性强。且快速适配了prometheus、statsd、influx line protocol等开源协议上报数据的用户，可以方便的将不同的数据协议进行整理、统一格式且将数据聚合之后上报到云监控中台。
性能：Tccm-Agent可接收流量80M/s，占用资源CPU：2C，MEM：60M

Tccm-SDK的设计与开发：分析了开源界（prometheus、datadog、influxdb等）和公司内（007、monitor等）监控系统的SDK的上报协议和实现，采用宽表（一张表多个维度多个指标）作为数据流转或存储协议，以文本作为数据传输协议，实现线程安全的多写单读队列作为中介进行缓冲数据，定时读取数据进行聚合处理后上报到Tccm-Agent；功能上支持公司内部和开源界所有的数据统计方式；支持多语言（go、c++、java等）
性能：SDK在不丢数据的情况下，最高可传输100w指标数每秒，流量70M/s，占用资源CPU：1.1C，MEM：100M