---
title: 3.CAP定理
---

CAP定理指出在一个异步的网络环境中，对于一个分布式读写存储系统来说，只能满足以下三项中的两项，而不可能满足全部三项。

- 一致性（`Consistency`）：客户端访问所有节点，返回的都是同一份最新的数据。线性一致性，读操作会返回最近一次写操作的结果。
- 可用性（`Availability`）：每次请求都能获取非错误的响应，但不保证获取的数据是最新数据。
- 分区容错性（`Partition Tolerance`）：节点之间由于网络分区而导致消息丢失的情况下，系统仍能继续正常运行。

对于一个分布式系统来说，节点之间是通过网络通信的，只要有网络，必然出现消息延迟或丢失，网络分区故障是必然发生的，所以分区容忍性是一个基本的要求。因此分布式系统分为2类，即 CP 或 AP。

也有一些其他观点认为：

- 其实由于网络分区很少发生，那么系统不存在网络分区的时候，可用性和一致性都可以满足。只有在网络分区时，才需要在一致性和可用性之间做出选择。
- 系统在正常运行过程中，网络延迟会存在。而 CAP 定理的经典解释是忽略网络延迟的，但在实际中延迟和分区紧密相关。系统在出现网络延迟时，如果选择放弃处理请求，则相当于降低了可用性；反之，如果选择继续处理请求，由于延迟存在，则会降低系统的一致性。系统需要在网络延迟时做出权衡。

后来，又延伸出 BASE（`Basically Available, Soft State, Eventually Consistent`）定理。即：基本可用、软状态和最终一致性。

其中软状态和最终一致性主要指：存在网络分区的情况下，为了高可用性，舍弃强一致性，选择一致性更弱的最终一致性。

最终一致性：当客户端更新某个数据时，可能因为网络分区或延迟，导致数据没有即时同步到所有节点，系统中存在旧数据。此时系统依然允许继续读写数据，但在最终某个时刻，系统保证这个更新操作一定会同步到所有节点。